#include <hidef.h> /* for EnableInterrupts macro */
#include "derivative.h" /* include peripheral declarations */

#define IIC_ERROR_STATUS 0
#define IIC_READY_STATUS 1
#define IIC_HEADER_SENT_STATUS 2
#define IIC_DATA_TRANSMISION_STATUS 3
#define IIC_DATA_SENT_STATUS 4

const char unal[1024] = { 0xFF, 0xFF, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
		0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
		0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
		0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
		0x07, 0x87, 0xC7, 0xC7, 0xE7, 0xF7, 0xF7, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF7, 0xE7, 0xE7,
		0xC7, 0xC7, 0x87, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
		0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
		0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
		0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0xFF, 0xFF, 0xFF,
		0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x80, 0xC0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFE, 0xFC, 0xF8, 0xF0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xF0, 0xFC, 0xFE, 0xFF, 0xFF, 0x0F,
		0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xFF, 0xFF, 0xFF,
		0xFF, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
		0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x3F, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFE, 0xFC, 0xF0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC,
		0xFC, 0xF8, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
		0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x7F, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0F,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x0F, 0x3F, 0xFF, 0xFF, 0xFF, 0xFC,
		0xF0, 0xE0, 0xE0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
		0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xFF, 0xFF, 0xFF,
		0xFF, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0xC0, 0xC0, 0xC0,
		0xC0, 0xFF, 0xFF, 0x7F, 0x3F, 0x0F, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x0F, 0x1F, 0x3F, 0x7F, 0x7F,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x7F, 0x3F, 0x1F, 0x0F, 0x03, 0x01, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
		0xFF, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE1, 0xE3, 0xE3,
		0xE7, 0xE7, 0xEF, 0xEF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xEF, 0xEF, 0xE7, 0xE7, 0xE3, 0xE3, 0xE1, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xFF, 0xFF };
const char intro[1024] = { 0x00, 0x08, 0xF8, 0x38, 0xC0, 0x38, 0xF8, 0x08, 0x00,
		0x20, 0x20, 0xE8, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x20, 0x20, 0x20, 0x60,
		0x00, 0x00, 0x20, 0xE0, 0x40, 0x20, 0x20, 0x00, 0x00, 0xC0, 0x20, 0x20,
		0x20, 0xC0, 0x00, 0x00, 0xC0, 0x20, 0x20, 0x20, 0x60, 0x00, 0x00, 0xC0,
		0x20, 0x20, 0x20, 0xC0, 0x00, 0x20, 0xE0, 0x40, 0x20, 0x20, 0xC0, 0x00,
		0x00, 0x20, 0xF0, 0x20, 0x20, 0x20, 0x00, 0x00, 0x20, 0xE0, 0x40, 0x20,
		0x20, 0x00, 0x00, 0xC0, 0x20, 0x20, 0x20, 0xC0, 0x00, 0x00, 0x00, 0x08,
		0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0xA0, 0xA0, 0xA0, 0xC0, 0x00, 0x00,
		0xC0, 0x20, 0x20, 0x48, 0xF8, 0x00, 0x00, 0xC0, 0x20, 0x20, 0x20, 0xC0,
		0x00, 0x00, 0x20, 0xE0, 0x40, 0x20, 0x20, 0x00, 0x00, 0xC0, 0xA0, 0xA0,
		0xA0, 0xC0, 0x00, 0x00, 0x40, 0xA0, 0xA0, 0xA0, 0x60, 0x00, 0x00, 0x10,
		0x14, 0x17, 0x14, 0x10, 0x14, 0x17, 0x14, 0x10, 0x14, 0x14, 0x17, 0x14,
		0x14, 0x10, 0x10, 0x13, 0x14, 0x14, 0x14, 0x12, 0x10, 0x10, 0x14, 0x17,
		0x14, 0x14, 0x10, 0x10, 0x10, 0x13, 0x14, 0x14, 0x14, 0x13, 0x10, 0x10,
		0x13, 0x14, 0x14, 0x14, 0x12, 0x10, 0x10, 0x13, 0x14, 0x14, 0x14, 0x13,
		0x10, 0x14, 0x17, 0x14, 0x10, 0x14, 0x17, 0x14, 0x10, 0x10, 0x13, 0x14,
		0x14, 0x14, 0x12, 0x10, 0x14, 0x17, 0x14, 0x14, 0x10, 0x10, 0x10, 0x13,
		0x14, 0x14, 0x14, 0x13, 0x10, 0x10, 0x14, 0x14, 0x17, 0x14, 0x14, 0x10,
		0x10, 0x13, 0x14, 0x14, 0x14, 0x17, 0x14, 0x10, 0x13, 0x14, 0x14, 0x14,
		0x17, 0x14, 0x10, 0x13, 0x14, 0x14, 0x14, 0x13, 0x10, 0x10, 0x14, 0x17,
		0x14, 0x14, 0x10, 0x10, 0x10, 0x13, 0x14, 0x14, 0x14, 0x14, 0x10, 0x10,
		0x16, 0x14, 0x14, 0x14, 0x13, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x84, 0x42, 0x22, 0x12, 0x8C, 0x00, 0x00, 0x00, 0xFC, 0x02, 0x02, 0x02,
		0x02, 0xFC, 0x00, 0x00, 0x00, 0x04, 0x04, 0xFE, 0x00, 0x00, 0x00, 0x00,
		0x1C, 0x22, 0x22, 0x22, 0xA2, 0x7C, 0x00, 0x00, 0x20, 0x20, 0x20, 0x20,
		0x20, 0x20, 0x00, 0x00, 0x00, 0x04, 0x04, 0xFE, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x04, 0x04, 0x04, 0x04, 0x05, 0x05, 0x05, 0x05,
		0x05, 0x04, 0x04, 0x04, 0x04, 0x05, 0x05, 0x05, 0x05, 0x04, 0x04, 0x04,
		0x04, 0x05, 0x05, 0x05, 0x05, 0x05, 0x04, 0x04, 0x05, 0x05, 0x05, 0x05,
		0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04,
		0x04, 0x05, 0x05, 0x05, 0x05, 0x05, 0x04, 0x04, 0x04, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x80, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x78, 0x4C, 0x46,
		0x72, 0x3A, 0x26, 0x20, 0x20, 0x78, 0x4C, 0x46, 0x72, 0x3A, 0x26, 0x20,
		0x20, 0x78, 0x4C, 0x46, 0x72, 0x3A, 0x26, 0x20, 0x78, 0x4C, 0x46, 0x72,
		0x3A, 0x26, 0x20, 0x20, 0x78, 0x4C, 0x46, 0x72, 0x3A, 0x26, 0x20, 0x20,
		0x20, 0x20, 0x20, 0xA0, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0xFF, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x5C, 0x47, 0x5C, 0xF0, 0x00,
		0x00, 0x00, 0x04, 0x04, 0xC4, 0xF4, 0xFF, 0xF4, 0xC4, 0x04, 0x04, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0x03, 0x01,
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
		0x01, 0xF9, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
		0x01, 0xF9, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0xFD, 0x00,
		0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x48, 0x50, 0x50, 0xDF,
		0x50, 0x50, 0x48, 0x48, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x20, 0x20,
		0x20, 0x20, 0x20, 0xFF, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x07, 0x1D, 0xF1, 0x1D, 0x07, 0x00, 0x00, 0x00, 0x0C, 0x0F,
		0x0F, 0x0F, 0xFF, 0x0F, 0x0F, 0x0F, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xC0, 0x80, 0x80, 0x80, 0x80, 0x80,
		0x80, 0x80, 0x80, 0x80, 0x84, 0x8C, 0x88, 0x88, 0x98, 0x90, 0x90, 0x90,
		0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x98, 0x88,
		0x88, 0x8C, 0x84, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
		0x80, 0x80, 0x80, 0x80, 0x80, 0xC0, 0x7F, 0x40, 0x20, 0x1F, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F,
		0x04, 0x08, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x06, 0x0C,
		0x09, 0x0B, 0x0C, 0x00, 0x00, 0x03, 0x06, 0x0C, 0x09, 0x0B, 0x0C, 0x00,
		0x00, 0x03, 0x06, 0x0C, 0x09, 0x0B, 0x0C, 0x00, 0x00, 0x03, 0x06, 0x0C,
		0x09, 0x0B, 0x0C, 0x00, 0x00, 0x03, 0x06, 0x0C, 0x09, 0x0B, 0x0C, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
unsigned char I2C_STEP = IIC_READY_STATUS, imagen;
unsigned char data[50], address, I2C_COUNTER = 0;
unsigned char I2C_LENGTH = 0;
unsigned int var1, var2, var3, var4;
unsigned short var;

void i2c_transmitir(void);
void i2c_load(unsigned char);
void oled_init(void);
void retardo(unsigned short);
void limpiar(void);

unsigned char dummy;

void i2c_init() {
	IICF_MULT = 0B00;		//multiplicador x1
	IICF_ICR = 0x07; 		//divisor SCL =40
	IICC1_IICEN = 1;		//enable del i2c
	IICC_IICIE = 1;
}

void i2c_transmitir() {
	unsigned char temp;
	I2C_STEP = IIC_HEADER_SENT_STATUS;		//envio de la direccion
	IICC_IICEN = 0;
	IICC_IICEN = 1;
	temp = IICS; /* Clear any pending interrupt */
	IICS_IICIF = 1;

	IICC_MST = 0;
	IICS_SRW = 0;
	IICC_TX = 1; /* Select Transmit Mode */
	IICC_MST = 1; /* Select Master Mode (Send Start Bit) */
	for (temp = 0; temp < 3; temp++)
		; /* Small delay */
	IICD = address;					//direccion del esclavo
	return;
}

interrupt VectorNumber_Viic void iic_isr() {

	unsigned char temp;
	temp = IICS;
	IICS_IICIF = 1;

	if (IICS_RXAK == 1) { /* SI ENTRA AL IF ES NACK */
		IICC_MST = 0;
		I2C_STEP = IIC_ERROR_STATUS;
		return;
	}
	if (I2C_STEP == IIC_HEADER_SENT_STATUS) { /* Header Sent */
		IICC_TX = 1;
		I2C_STEP = IIC_DATA_TRANSMISION_STATUS;
	}
	if (I2C_STEP == IIC_DATA_TRANSMISION_STATUS) { /* If byte transmision is in progress.*/

		IICD = data[I2C_COUNTER]; /* Send the next byte */
		I2C_COUNTER++;

		if (I2C_LENGTH <= I2C_COUNTER) {
			I2C_STEP = IIC_DATA_SENT_STATUS; /* Mark we are done sending Bytes */
		}
		return; /* wait until last byte sent      */

	}
	if (I2C_STEP == IIC_DATA_SENT_STATUS) { /* We are done with the transmition.*/
		I2C_LENGTH = 0;
		I2C_COUNTER = 0;
		for (var1 = 0; var1 < 50; var1++) {
			data[var1] = 0;
		}

		I2C_STEP = IIC_READY_STATUS; /* Reset our status flag            */
		temp = IICS; /* ACK the interrupt                */
		IICS_IICIF = 1;

		IICC_TX = 0;
		IICS_SRW = 0;
		IICC_MST = 0;
		/* Generate a stop condition        */
		return;
	}
}

void rtc_init() {
	ICSC1_IRCLKEN = 1;//se activa el uso del reloj interno del microcontrolador
	RTCMOD = 5;
	RTCSC_RTIE = 1;
	RTCSC_RTCLKS = 0b00;
	RTCSC_RTCPS = 0b1111;
}

interrupt VectorNumber_Vrtc void rtc_isr() {
	RTCSC_RTIF = 1;					//limpia la bandera de interrucpion por RTC
	PTDD_PTDD6 = !PTDD_PTDD6;
	EnableInterrupts;
	limpiar();
	imagen = !imagen;
	if (imagen) {
		for (var3 = 0; var3 < 1024; var3++) {
			address = 0x78;
			i2c_load(0x40); //Poner la pantalla en modo escritura
			i2c_load(intro[var3]);
			i2c_transmitir();
			while (I2C_STEP != IIC_READY_STATUS)
				;
		}
	} else {
		for (var3 = 0; var3 < 1024; var3++) {
			address = 0x78;
			i2c_load(0x40); //Poner la pantalla en modo escritura
			i2c_load(unal[var3]);
			i2c_transmitir();
			while (I2C_STEP != IIC_READY_STATUS)
				;
		}

	}
	
	DisableInterrupts;
}

void main(void) {
	SOPT1 = 0x52;

	PTDDD_PTDDD6 = 1;
	PTDD_PTDD6 = 0;

	rtc_init();
	i2c_init();

	EnableInterrupts
	;

	retardo(60000);
	retardo(60000);
	retardo(60000);
	retardo(60000);
	retardo(60000);
	PTDD_PTDD6 = 1;
	address = 0x78;
	oled_init();

	for (;;) {

	} /* loop forever */
	/* please make sure that you never leave main */
}

void i2c_load(unsigned char bytes) {
	data[I2C_LENGTH] = bytes;
	I2C_LENGTH = I2C_LENGTH + 1;
	return;
}

void oled_init() {
	//Le decimos a la pantalla que viene una lista de comandos de configuracion
	i2c_load(0x00);

	//Apagar la pantalla
	i2c_load(0xAE);

	// Establecer el maximo de filas a 0x3F = 63
	// es decir, ira de 0 a 63, por tanto tenemos 64 filas de pixeles
	i2c_load(0xA8);
	i2c_load(0x3F);

	//Poner el offset a 0
	i2c_load(0xD3);
	i2c_load(0x00);

	//Poner el comienzo de linea a 0
	i2c_load(0x40);

	//Invertir el eje X de pantalla, por si esta girada.
	//Puedes cambiarlo por 0xA0 si necesitas cambiar la orientacion
	i2c_load(0xA1);

	//Invertir el eje Y de la patnalla
	//Puedes cambiarlo por 0xC0 si necesitas cambiar la orientacion
	i2c_load(0xC8);

	//Mapear los pines COM
	i2c_load(0xDA);
	i2c_load(0x12);
	//Al parecer, la unica configuracion que funciona con mi modelo es 0x12, a pesar
	// de que en la documentacion dice que hay que poner 0x02

	//Configurar el contraste
	i2c_load(0x81);
	i2c_load(0x7F); //Este valor tiene que estar entre 0x00 (min) y 0xFF (max)

	//Este comando ordena al chip que active el output de la pantalla en funcion del contenido
	//almacenado en su GDDRAM
	i2c_load(0xA4);

	//Poner la pantalla en modo Normal
	i2c_load(0xA6);

	//Establecer la velocidad del Oscilador
	i2c_load(0xD5);
	i2c_load(0x80);

	//Activar el 'charge pump'
	i2c_load(0x8D);
	i2c_load(0x14);

	//Encender la pantalla
	i2c_load(0xAF);

	//Como extra, establecemos el rango de columnas y paginas
	i2c_load(0x21); //Columnas de 0 a 127
	i2c_load(0x00);
	i2c_load(0x7F);
	i2c_load(0x22); //Paginas de 0 a 7
	i2c_load(0x00);
	i2c_load(0x07);

	//Modo de escritura horizontal
	//en mi modelo no haria falta enviar este comando (por defecto utiliza este modo)
	i2c_load(0x20);
	i2c_load(0x00);
	//enviar datos cargados
	i2c_transmitir();

	while (I2C_STEP != IIC_READY_STATUS)
		;
	
	limpiar();

	for (var3 = 0; var3 < 1024; var3++) {
		address = 0x78;
		i2c_load(0x40); //Poner la pantalla en modo escritura
		i2c_load(unal[var3]);
		i2c_transmitir();
		while (I2C_STEP != IIC_READY_STATUS)
			;
	}

}

void limpiar(){
	for (var4 = 0; var4 < 1024; var4++) {
			address = 0x78;
			i2c_load(0x40);
			i2c_load(0x00);
			i2c_transmitir();
			while (I2C_STEP != IIC_READY_STATUS)
				;
		}
}

void retardo(unsigned short max) {
	for (var = 0; var < max; ++var) {
	}
}
